<!DOCTYPE html>
<html>
<head>
<title>Quilt Generated Image</title>

<script src="http://openlayers.org/api/2.12/OpenLayers.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

<script type="text/javascript">
var map;
var mapBounds;
var mapMinZoom = 0;
var mapMaxZoom;
var squareSize;

// Avoid dead tiles
OpenLayers.IMAGE_RELOAD_ATTEMPTS = 3;
OpenLayers.Util.onImageLoadErrorColor = "transparent";

function init() {
    var options = {
        controls: [
            new OpenLayers.Control.Navigation({
                dragPanOptions: {
                    enableKinetic: true
                }
            }),
        ],
        maxExtent: mapBounds,
        // Size of a side divided by tile size
        maxResolution: squareSize / 256,
        numZoomLevels: mapMaxZoom + 1,
        center: [0, 0],
    };

    map = new OpenLayers.Map('map', options);

    var layer = new OpenLayers.Layer.TMS(
        "quilt",
        "",
        {
            type: "jpg",
            getURL: overlay_getTileURL,
            attribution: "Generated by <a href='http://github.com/eharmon/quilt'>quilt</a>",
        }
    );

    map.addLayer(layer);

    map.zoomToExtent(mapBounds, true);

    map.addControl(new OpenLayers.Control.PanZoomBar());
    map.addControl(new OpenLayers.Control.KeyboardDefaults());
    map.addControl(new OpenLayers.Control.Attribution());
}

function overlay_getTileURL(bounds) {
    var res = this.map.getResolution();
    var x = Math.round((bounds.left - this.maxExtent.left) / (res * this.tileSize.w));
    var y = Math.round((this.maxExtent.top - bounds.top) / (res * this.tileSize.h));
    var z = this.map.getZoom();
    if(x >= 0 && y >= 0) {
        return this.url + z + "/" + x + "/" + y + "." + this.type;
    } else {
        return this.url + "blank.gif";
    }
}

$(window).resize(function() {
    var map = $("#map");
    map.height($(window).height());
    map.width($(window).width());
    if(map.updateSize) {
        map.updateSize();
    };
});

$(document).ready(function () {
    $(window).resize();
    $.getJSON('map_configuration.json', function(data) {
        squareSize = data['size'];
        mapMaxZoom = data['max'];
        mapBounds = new OpenLayers.Bounds(0.0, 0.0, squareSize, squareSize);
        mapMaxZoom = mapMaxZoom;
        init();
    });
});
</script>

<style type="text/css">
body {
    margin: 0;
    padding: 0;
    font-family: Helvetica, Arial, sans-serif;
}
.olControlAttribution {
    padding: 0.2em;
    background-color: #FFFFFF;
    border: 1px solid black;
    /* !important because openlayers inserts CSS, making it difficult to override */
    bottom: 2px !important;
}
</style>

</head>
<body>
<div id="map"></div>
</body>
</html>
