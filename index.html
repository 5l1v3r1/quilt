<!DOCTYPE html>
<html>
<head>
<title>Quilt Loading...</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js"></script>
<link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/css/ol.css">
<script type="text/javascript">
function init(squareSize, mapMaxZoom, tileSize, attribution) {
    var maxX = squareSize;
    var maxY = squareSize;

    var projection = new ol.proj.Projection({
        code: 'ZOOMIFY',
        units: 'pixels',
        extent: [0, 0, maxX, maxY]
    });
    var projectionExtent = projection.getExtent();

    var maxResolution = ol.extent.getWidth(projectionExtent) / tileSize;

    window.resolutions = [];
    for (var z = 0; z < mapMaxZoom; z++) {
        resolutions[z] = maxResolution / Math.pow(2, z + 1);
    }

    var tileLayer = new ol.layer.Tile({
        source: new ol.source.XYZ({
            attributions: [attribution, 'Generated by <a href="https://github.com/eharmon/quilt">quilt</a>'].join(' / '),
            url: '{z}/{x}/{y}.png',
            tilePixelRatio: 2,
            projection: projection,
        }),
        extent: projectionExtent
    });

    var viewport = document.getElementById('map');

    function getMinZoom() {
        var width = viewport.clientWidth;
        return Math.ceil(Math.LOG2E * Math.log(width / 256));
    }
    var initialZoom = getMinZoom();

    var view = new ol.View ({
        projection: projection,
        center: [maxX / 2, maxY / 2],
        zoom: initialZoom,
        extent: projectionExtent,
        resolutions: resolutions
    });

    var attribution = new ol.control.Attribution({
        collapsible: false
    });
    var zoomslider = new ol.control.ZoomSlider();

    window.map = new ol.Map({
        layers: [tileLayer],
        target: 'map',
        view: view,
        controls: ol.control.defaults({attribution: false}).extend([attribution, zoomslider])
    });

    function checkSize() {
        var small = map.getSize()[0] < 600;
        attribution.setCollapsible(small);
        attribution.setCollapsed(small);
    }

    $(window).on('resize', checkSize);
}

$(document).ready(function () {
    $.getJSON('map_configuration.json', function(data) {
        squareSize = data['size'];
        mapMaxZoom = data['max'];
        document.title = data['title'];
        init(data['size'], data['max'], data['tile_size'], data['attribution']);
    });
});
</script>

<style type="text/css">
body {
    font-family: Helvetica, Arial, sans-serif;
}
#map {
    position: fixed;
    width: 100%;
    height: 100%;
    left: 0;
    top: 0;
}
</style>

</head>
<body>
<div id="map"></div>
</body>
</html>
